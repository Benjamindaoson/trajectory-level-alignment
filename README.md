# Trajectory-Level Alignment & Intent Drift Detection

ä¼ ç»Ÿå¯¹é½æ–¹æ³•ä¸»è¦å…³æ³¨ **å•æ­¥è¾“å‡ºçš„æ­£ç¡®æ€§**ï¼ˆå¦‚æ˜¯å¦å›ç­”å‡†ç¡®ã€æ˜¯å¦åˆè§„ï¼‰ã€‚
 ç„¶è€ŒçœŸå®åº”ç”¨ä¸­ï¼Œå¤§æ¨¡å‹å¾€å¾€æ‰§è¡Œ **å¤šæ­¥æ¨ç†ã€é•¿é“¾å¯¹è¯æˆ–å¤šæ™ºèƒ½ä½“åä½œä»»åŠ¡**ï¼Œå¦‚ï¼š

- æ•™å­¦åœºæ™¯ä¸­çš„é€æ­¥çŸ¥è¯†å¼•å¯¼
- é‡‘èåˆè§„ç ”ç©¶ï¼šæ•°æ® â†’ æ¨ç† â†’ å»ºè®®é“¾è·¯
- å“ç‰Œå†…å®¹ç”Ÿæˆä¸å¤šè§’è‰²å®¡æ ¡
- å¤š Agent åä½œæ‰§è¡Œä¼ä¸šæµç¨‹

åœ¨æ­¤ç±» **é•¿æ—¶æ®µä»»åŠ¡** ä¸­ï¼Œå³ä½¿æ¯ä¸€æ­¥éƒ½â€œçœ‹ä¼¼åˆç†â€ï¼Œ
 æ¨¡å‹çš„ **æ•´ä½“æ¨ç†è½¨è¿¹** ä»å¯èƒ½ **é€æ¸åç¦»åŸå§‹ç›®æ ‡ä¸çº¦æŸ**ã€‚

è¿™ç±»åç¦»ç§°ä¸ºï¼š

> **Intent Driftï¼ˆæ„å›¾æ¼‚ç§»ï¼‰** â€”â€” ä¸æ˜¯å•æ­¥é”™è¯¯ï¼Œè€Œæ˜¯ **ç­–ç•¥éšæ—¶é—´çš„åèˆª**ã€‚

| åœºæ™¯                 | æ„å›¾æ¼‚ç§»å¸¦æ¥çš„é£é™©                 |
| -------------------- | ---------------------------------- |
| é‡‘èç ”ç©¶ â†’ æ¨è      | é€æ¸è¶Šè¿‡é£é™©/åˆè§„è¾¹ç•Œ              |
| æ•™è‚²è¾…å¯¼ â†’ çŸ¥è¯†è®²è§£  | èŠ‚å¥ç´Šä¹±ã€æå‰â€œè·³çº§â€æˆ–è„±ç¦»æ•™å­¦ç›®æ ‡ |
| å“ç‰Œå†…å®¹ â†’ å®¡æŸ¥é“¾è·¯  | å£å»/ç«‹åœº/æ‰¿è¯ºé€æ­¥å¤±æ§             |
| å¤š Agent åä½œ â†’ è°ƒåº¦ | ä»»åŠ¡é“¾å¤±ç¨³ã€æ— æ³•å›æº¯               |

**å› æ­¤ï¼Œå¯¹é½å¿…é¡»ä»â€œå•æ­¥â€ä¸Šå‡åˆ°â€œè½¨è¿¹çº§â€ã€‚**

# IDS Minimal åšäº†ä»€ä¹ˆï¼Ÿ

**IDS Minimal** æä¾›ä¸€å¥— **å¯çº¿ä¸Šéƒ¨ç½²çš„â€œè½¨è¿¹çº§å¯¹é½ä¸æ¼‚ç§»ç›‘æ§å±‚â€**ï¼Œç”¨äºåˆ¤æ–­æ¨¡å‹æ˜¯å¦ä»ä¿æŒåœ¨æ—¢å®šç›®æ ‡è½¨è¿¹å†…ã€‚åœ¨æ¯ä¸€æ­¥æ¨ç†ä¸­ï¼Œç³»ç»Ÿä¼šå®æ—¶è®¡ç®—å¹¶ç´¯ç§¯ä¸‰ç±»åç§»ï¼š

| Drift ç±»å‹           | æ£€æµ‹å†…å®¹                     | ç¤ºä¾‹                           |
| -------------------- | ---------------------------- | ------------------------------ |
| **Semantic Drift**   | å½“å‰å†…å®¹æ˜¯å¦åç¦»ç›®æ ‡è¯­ä¹‰æ–¹å‘ | æœ¬åº”è®² Q-learning å´å¼€å§‹è®² PPO |
| **Structural Drift** | æ˜¯å¦è¿åæ­¥éª¤æˆ–ä¾èµ–é¡ºåº       | æœªå®Œæˆé£é™©åˆ†æå°±ç›´æ¥ç»™æŠ•èµ„å»ºè®® |
| **Temporal Drift**   | æ‰§è¡Œæ—¶æœºæ˜¯å¦åˆç†             | æ— æ„ä¹‰åå¤åœç•™/æå‰ç»ˆæ­¢        |

ä¸‰è€…èåˆä¸ºä¸€ä¸ª **å•è°ƒç´¯ç§¯æŒ‡æ ‡**ï¼š**Intent Drift Score (IDS)**

**IDS è¶Šé«˜ï¼Œè¯´æ˜è½¨è¿¹è¶Šå¯èƒ½å‘ç”Ÿåèˆª**ï¼Œå¯è§¦å‘ï¼š

- ğŸ” **è‡ªåŠ¨é‡è§„åˆ’**
- ğŸ§ **äººå·¥æ¥ç®¡**
- ğŸ§¯ **å›é€€åˆ°ç¨³å®šçŠ¶æ€**

# ä¸ºä»€ä¹ˆç°æœ‰å¯¹é½æ–¹æ³•æ— æ³•è§£å†³æ„å›¾æ¼‚ç§»ï¼Ÿ

ä¸»æµå¯¹é½æ–¹æ¡ˆï¼ˆSFT / RLHF / DPO / Constitutional AIï¼‰éƒ½éšå«åŒä¸€ä¸ªå‡è®¾ï¼š

> **æ¨¡å‹è¡Œä¸ºåœ¨éƒ¨ç½²åæ˜¯é™æ€çš„ã€‚**

ä½†åœ¨ **é•¿é“¾æ¨ç†ã€å¤šè½®äº’åŠ¨ã€å¤š Agent åä½œ** ä¸­ï¼š

- æ¨¡å‹ä¼šæ ¹æ®ä¸Šä¸‹æ–‡ã€ç¯å¢ƒåé¦ˆå’Œå†å²å¯¹è¯ **æ”¹å˜ç­–ç•¥è§£é‡Šæ–¹å¼**
- è¿™ä¸ªå˜åŒ–æœ¬èº« **ä¼šå¼•å…¥è½¨è¿¹çº§åç¦»**
- åç¦»ä¸æ˜¯ç¬æ—¶çš„ï¼Œè€Œæ˜¯ **é€æ­¥ç§¯ç´¯**

å› æ­¤ï¼š**æ„å›¾æ¼‚ç§»ä¸æ˜¯â€œè®­ç»ƒä¸å¤Ÿâ€ï¼Œè€Œæ˜¯â€œåŠ¨æ€ç­–ç•¥ç³»ç»Ÿç¼ºå°‘ç¨³å®šæ€§æ§åˆ¶å±‚â€ã€‚**

è¦è§£å†³å®ƒï¼Œå°±å¿…é¡»ï¼šå¯¹é½è¡Œä¸ºéšæ—¶é—´çš„æ¼”åŒ–è½¨è¿¹ï¼Œè€Œä¸ä»…æ˜¯å¯¹é½å½“ä¸‹è¡Œä¸ºæœ¬èº«ã€‚

è¿™ç§°ä¸ºï¼š

# **Trajectory-Level Alignment**

# ä¸ºä»€ä¹ˆ IDS æ˜¯ç³»ç»Ÿçš„â€œå¿…è¦ç»“æ„å±‚ï¼ˆDefault Safety Layerï¼‰â€ï¼Ÿ

å¤šæ­¥éª¤ LLM/å¤šæ™ºèƒ½ä½“ç³»ç»Ÿï¼Œæœ¬è´¨æ˜¯ **åŠ¨æ€æ¼”åŒ–ç³»ç»Ÿ**ï¼š

- CoT èƒ½å±•å¼€æ¨ç†ï¼Œä½†ä¸èƒ½ä¿è¯æ¨ç†è·¯å¾„ä¸åç¦»
- RLHF èƒ½å¡‘é€ åå¥½ï¼Œä½†æ— æ³•çº¦æŸç­–ç•¥éšæ—¶é—´çš„æ¼‚ç§»
- DPO èƒ½è°ƒè¡Œä¸ºï¼Œä½†æ— æ³•åˆ¤æ–­ **â€œæ˜¯å¦æ­£åœ¨åèˆªâ€**

å› æ­¤ï¼šIDS æ˜¯é•¿é“¾ LLM ç³»ç»Ÿçš„â€œåèˆªç›‘æ§ä»ªï¼ˆStability Monitorï¼‰â€ã€‚

å®ƒä¸æ˜¯å¢å¼ºé¡¹ï¼Œè€Œæ˜¯ï¼šå¤šæ­¥æ¨¡å‹å¿…é¡»å…·å¤‡çš„ç¨³å®šæ€§åŸºç¡€å±‚ã€‚

# ç³»ç»Ÿæ¶æ„

```
LLM / Multi-Agent System
        â”‚
        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   IDS Layer: Trajectory Alignment   â”‚
â”‚  â€¢ Semantic / Structural / Temporal Drift Scoring
â”‚  â€¢ Goal & Dependency Graph
â”‚  â€¢ Streaming Prefix-Monotonic Drift Accumulation
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼
Policy Decision: Continue / Replan / Human Override
```

**O(T) æµå¼è®¡ç®—ï¼Œä½å¼€é”€ï¼Œå¯ç›´æ¥æŒ‚æ¥ï¼š**

- LangChain / DSPy / MCP å·¥ä½œæµ
- ä¼ä¸šå†…å®¹/åˆè§„/è¿è¡Œå®¡è®¡ç³»ç»Ÿ
- å¤šæ™ºèƒ½ä½“æ‰§è¡Œæ¡†æ¶

# ç³»ç»Ÿç›®æ ‡ä¸æ˜¯â€œè®©æ¨¡å‹æ›´èªæ˜â€

è€Œæ˜¯ï¼š

> **è®©æ¨¡å‹åœ¨é•¿é“¾ä»»åŠ¡ä¸­ä¿æŒç¨³å®šã€ä¸è·‘åã€‚**

å› æ­¤å…·å¤‡ï¼š

| èƒ½åŠ›                | æè¿°       |
| ------------------- | ---------- |
| **Controllability** | è½¨è¿¹å¯æ§   |
| **Auditability**    | å†³ç­–å¯æº¯æº |
| **Recoverability**  | åèˆªå¯å›é€€ |

å³ï¼šæ¨¡å‹ä¸æ˜¯å˜â€œç„â€ï¼Œè€Œæ˜¯å˜â€œç¨³â€ã€‚

# å…³é”®ç‰¹æ€§ï¼ˆKey Featuresï¼‰

| èƒ½åŠ›                           | ä»·å€¼                       |
| ------------------------------ | -------------------------- |
| **Trajectory-Level Alignment** | é˜²æ­¢â€œçœ‹ä¼¼æ¯æ­¥å¯¹ï¼Œæ•´ä½“èµ°åâ€ |
| **Intent Drift Score (IDS)**   | æä¾›å¯è®¡ç®—çš„åèˆªåº¦é‡       |
| **æµå¼ O(T) æ›´æ–°**             | å¯ç›´æ¥çº¿ä¸Šéƒ¨ç½²             |
| **Goal Graph**                 | ä¿è¯æ‰§è¡Œè·¯å¾„é¡ºåºåˆæ³•       |
| **Telemetry Trace**            | å¯ç”¨äºé£æ§/å®¡è®¡/å†è®­ç»ƒ     |
| **Model-Agnostic**             | ä¸ä¾èµ–å…·ä½“æ¨¡å‹æˆ–è®­ç»ƒæ–¹å¼   |

# Repository ç»“æ„

```
ids_minimal/
â”œâ”€â”€ core.py          # Intent Drift Scoring
â”œâ”€â”€ goal_graph.py    # ç›®æ ‡ä¾èµ–å›¾
â””â”€â”€ demo_travel.py   # ç¤ºä¾‹ï¼šæ—…è¡Œè®¡åˆ’ä»»åŠ¡
```

# å£°æ˜

```
Â© 2025 Jianming Lai (Benjamin Daoson). All rights reserved.
This repository provides a minimal reference implementation for research and demonstration.
The full production implementation remains proprietary.
```



